group 'com.github.dolphineor'
version '0.1.0-SNAPSHOT'

buildscript {
    repositories {
        jcenter()
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }

    dependencies {
        classpath "org.flywaydb:flyway-gradle-plugin:$flywayPluginVersion"
        classpath "us.kirchmeier:gradle-capsule-plugin:$capsulePluginVersion"
    }
}

apply plugin: 'org.flywaydb.flyway'
apply plugin: 'us.kirchmeier.capsule'

configurations {
    // Use logback-slf4j instead of the Spring's commons-logging
    all*.exclude group: 'commons-logging', module: 'commons-logging'
}

ext {

    def props = new Properties();
    file("src/main/resources/jdbc-h2.properties").withInputStream {
        props.load(it)
    }
    props.each {
        project.extensions.add("$it.key", it.value);
    }
}

flyway {
    url = project['jdbc.url']
    user = project['jdbc.username']
    password = project['jdbc.password']
    locations = ["filesystem:db/migration"]
}

task fatCapsule(type: FatCapsule) {
    applicationClass 'com.github.dolphineor.boot.WebAppBoot'

    baseName = rootProject.name

    capsuleManifest {
        args = ['--very-fancy']
        minJavaVersion = '1.8'
    }
}
